const body=document.querySelector("body"),popapMenu=body.querySelector(".popap-menu"),headerMenu=body.querySelector(".header__wrapper-menu"),headerButtonMenu=headerMenu.querySelector(".header__button-menu"),popapMenuClose=popapMenu.querySelector(".popap-menu__close"),overlay=body.querySelector(".overlay"),popapLinks=popapMenu.querySelectorAll(".popap-menu__link"),buyTourButtons=body.querySelectorAll(".travel-places__button"),popapForm=body.querySelector(".popap-form"),popapFormClose=popapForm.querySelector(".popap-form__close"),popapPhoneField=popapForm.querySelector(".popap-form__form-input--phone"),popapMailField=popapForm.querySelector(".popap-form__form-input--mail"),pricesCartCutton=body.querySelectorAll(".prices__cart-button"),questionsForm=body.querySelector(".questions__form"),questionsPhoneField=questionsForm.querySelector(".questions__form-input--phone"),questionsMailField=questionsForm.querySelector(".questions__form-input--mail"),avatarTravels=body.querySelectorAll(".travels__item"),travelLinks=body.querySelectorAll(".travel-places__link"),travelCarts=body.querySelectorAll(".travel-places__item-cart"),dataSabmitUrl="https://echo.htmlacademy.ru/",success=body.querySelector("#success").content.querySelector(".success"),errorSuccess=body.querySelector("#error-loading").content.querySelector(".error-loading"),cartActive="travel-places__item-cart--active",buttonActive="travel-places__link--active",successElement=success.cloneNode(!0),errorElement=errorSuccess.cloneNode(!0);headerMenu.classList.add("d-block"),popapMenu.classList.add("d-none");const isEscEvent=e=>e.key===keys.escape||e.key===keys.esc,alertError=()=>{popapPhoneField&&popapPhoneField.classList.add("error"),questionsPhoneField&&questionsPhoneField.classList.add("error")},removeError=()=>{popapPhoneField&&popapPhoneField.classList.remove("error")},onClickRemoveMenu=()=>{popapMenu.classList.add("d-none"),popapMenu.classList.remove("active"),overlay.classList.add("d-none")},onClickActiveMenu=e=>{e.preventDefault(),popapMenu.classList.remove("d-none"),popapMenu.classList.add("active")},onCloseBuyTour=e=>{e&&e.preventDefault(),popapForm.classList.add("d-none"),overlay.classList.add("d-none")},onEscRemove=e=>{"Escape"!==e.key&&"Esc"!==e.key||(onCloseBuyTour(),document.removeEventListener("keydown",onCloseBuyTour))};let isStorageSupport=!0,storage="";try{storage=localStorage.getItem("phone")}catch(e){isStorageSupport=!1}const onBuyTour=e=>{e&&e.preventDefault(),popapForm.classList.remove("d-none"),overlay.classList.remove("d-none"),removeError(),popapForm&&(storage?(popapPhoneField.value=storage,popapMailField.focus()):popapPhoneField.focus())};for(const e of popapLinks)e.addEventListener("click",onClickRemoveMenu);for(const e of buyTourButtons)e.addEventListener("click",onBuyTour);for(const e of pricesCartCutton)e.addEventListener("click",onBuyTour);const onSuccessRemove=()=>{successElement.remove(),document.removeEventListener("click",onSuccessRemove)},onElementEscRemove=()=>{isEscEvent&&(onSuccessRemove(),document.removeEventListener("keydown",onElementEscRemove))},alertSuccess=()=>{body.append(successElement),document.addEventListener("keydown",onElementEscRemove),document.addEventListener("click",onSuccessRemove)},resetForm=()=>{questionsPhoneField.value="",questionsMailField.value=""},alertForm=()=>{body.append(successElement),document.addEventListener("keydown",onElementEscRemove),document.addEventListener("click",onSuccessRemove),questionsPhoneField.value="",questionsMailField.value="",onCloseBuyTour()},onErrorLoadingRemove=()=>{errorElement.remove(),document.removeEventListener("click",onErrorLoadingRemove)},onEscRemoveRemove=()=>{isEscEvent&&(errorElement.remove(),document.removeEventListener("keydown",onEscRemoveRemove))},alertErrorloading=()=>{body.append(errorElement),document.addEventListener("keydown",onEscRemoveRemove),document.addEventListener("click",onErrorLoadingRemove)},sendData=(e,o,t,r)=>{fetch(e,{method:"POST",body:o}).then((e=>{e.ok?t():r()})).catch((()=>{r()}))},onCangeModalform=e=>{popapPhoneField.value?(removeError(),isStorageSupport&&localStorage.setItem("phone",popapPhoneField.value)):(e.preventDefault(),popapPhoneField&&popapPhoneField.classList.add("error"),questionsPhoneField&&questionsPhoneField.classList.add("error"))},onFormSend=e=>{e.preventDefault();const o=new FormData(e.target);var t,r;t=alertForm,r=alertErrorloading,fetch(dataSabmitUrl,{method:"POST",body:o}).then((e=>{e.ok?t():r()})).catch((()=>{r()}))},switchSlides=(e,o,t)=>{for(let r=0;r<e.length;r++)e[r].addEventListener("click",(()=>{for(let r=0;r<e.length;r++)t[r].classList.remove(cartActive),o[r].classList.remove(buttonActive);t[r].classList.add(cartActive),o[r].classList.add(buttonActive)}))};switchSlides(avatarTravels,travelLinks,travelCarts),switchSlides(travelLinks,travelLinks,travelCarts),popapPhoneField.addEventListener("change",onCangeModalform),questionsForm.addEventListener("submit",onFormSend),popapForm.addEventListener("submit",onFormSend),popapFormClose.addEventListener("click",onCloseBuyTour),document.addEventListener("keydown",onEscRemove),overlay.addEventListener("click",onCloseBuyTour),headerButtonMenu.addEventListener("click",onClickActiveMenu),popapMenuClose.addEventListener("click",onClickRemoveMenu);